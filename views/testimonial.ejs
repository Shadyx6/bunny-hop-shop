<%- include('./partials/Header.ejs', {hidden: true}) %>

<style>
  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1rem;
    box-sizing: border-box;
  }

  .testimonial-layout {
    display: flex;
    gap: 3rem;
  }

  .testimonial-layout aside {
    min-width: 0;
  }
  .testimonial-section {
    display: flex;
    flex-direction: column;
    gap: 4rem;
  }
  .testimonial-item {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin-bottom: 2rem;
  }
  .insta {
    display: flex;
    align-items: center;
    justify-content: flex-end;
  }

  @media(max-width: 900px) {
    .testimonial-layout {
      flex-direction: column;
    }
  }
</style>

<main style="padding: var(--spacing-xl) 0; background-color: var(--color-bg-secondary); min-height: 100vh;">
    <div class="container">

        <!-- Flash Messages -->
        <% if(typeof error !=='undefined' && error.length> 0) { %>
            <div
                style="background: #fee2e2; color: #dc2626; padding: 1rem; border-radius: var(--border-radius-md); margin-bottom: 2rem; text-align: center;">
                <%= error[0] %>
            </div>
        <% } %>
        <% if (typeof success !=='undefined' && success.length> 0) { %>
            <div
                style="background: #dcfce7; color: #166534; padding: 1rem; border-radius: var(--border-radius-md); margin-bottom: 2rem; text-align: center;">
                <%= success[0] %>
            </div>
        <% } %>

        <div class="testimonial-layout">
            <!-- Sidebar -->
            <aside>
                <%- include('./partials/SellerSidebar.ejs') %>
            </aside>

            <!-- Main Content -->
            <div class="testimonial-section">
              <div class="add-testimonial" style="width: 100%; padding: 0.8rem; margin-bottom: 0.5rem; border: 1px solid var(--color-border); border-radius: 4px;">
                <h1><%= editingTestimonial ? "Edit Testimonial" : "Add Testimonial" %></h1>
                <form action="<%= editingTestimonial ? '/seller/testimonial/edit/' + editingTestimonial._id : '/seller/testimonial' %>" method="POST">

                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Username:</label>
                    <input type="text" name="username" value="<%= editingTestimonial ? editingTestimonial.username : '' %>" 
                          style="width: 100%; padding: 0.8rem; margin-bottom: 0.5rem; border: 1px solid var(--color-border); border-radius: 4px;"
                          required />

                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Instagram Link:</label>
                    <input type="text" name="instagramLink"
                          value="<%= editingTestimonial ? editingTestimonial.instagramLink : '' %>"
                          style="width: 100%; padding: 0.8rem; margin-bottom: 0.5rem; border: 1px solid var(--color-border); border-radius: 4px;" />

                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Message:</label>
                    <textarea name="message" rows="4"
                              style="width: 100%; padding: 0.8rem; margin-bottom: 0.5rem; border: 1px solid var(--color-border); border-radius: 4px; font-family: inherit;"
                              required><%= editingTestimonial ? editingTestimonial.message : '' %></textarea>

                    <button type="submit" class="btn btn-primary" style="padding: 0.8rem 2rem; align-self: flex-start;">
                        <%= editingTestimonial ? "Update Testimonial" : "Add Testimonial" %>
                    </button>
                </form>
              </div>


              <div class="your-testimonial" style="width: 100%; padding: 0.8rem; margin-bottom: 0.5rem; border: 1px solid var(--color-border); border-radius: 4px;">
                <h1>Your Testimonials</h1>
                <% if (testimonials.length > 0) { %>
                  <% testimonials.forEach(t => { %>
                    <div class="testimonial-item">
                      <div>
                        <p style="width: 100%; padding: 0.8rem; margin-bottom: 0.5rem; border: 1px solid var(--color-border); border-radius: 4px;">
                          <strong>Username:</strong> <%= t.username %>
                        </p>
                        <p style="width: 100%; padding: 0.8rem; margin-bottom: 0.5rem; border: 1px solid var(--color-border); border-radius: 4px;">
                          <strong>Message:</strong> <%= t.message %>
                        </p>
                        <% if(t.instagramLink) { %>
                          <a href="<%= t.instagramLink %>" target="_blank" class="insta">From Instagram</a>
                        <% } %>
                      </div>

                      <div>
                        <button class="btn btn-primary">
                          <a href="/seller/testimonial?edit=<%= t._id %>">Edit</a>
                        </button>
                        <form action="/seller/testimonial/delete/<%= t._id %>" method="POST" style="display:inline;">
                          <button onclick="return confirm('Delete this testimonial?')" class="btn btn-primary">Delete</button>
                        </form>
                      </div>
                    </div>
                  <% }) %>
                <% } else { %>
                    <p>No testimonials yet.</p>
                <% } %>
              </div>
            </div>
        </div>
    </div>
</main>

